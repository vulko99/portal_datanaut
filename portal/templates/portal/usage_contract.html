{% extends "portal/base_portal.html" %}

{% block title_suffix %} · Usage – Contract inventory{% endblock %}

{% block content %}
<div class="mb-3">
  <ul class="nav nav-pills nav-sm bg-dark rounded-pill px-1 py-1 d-inline-flex shadow-sm">
    <li class="nav-item">
      <a class="nav-link text-white-50 px-3"
         href="{% url 'portal:usage_invoices' %}">
        Invoice inventory
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link active px-3" aria-current="page"
         href="{% url 'portal:usage_contract' %}">
        Contract inventory
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-white-50 px-3"
         href="{% url 'portal:usage_vendors' %}">
        Vendor inventory
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link text-white-50 px-3"
         href="{% url 'portal:usage_users' %}">
        User inventory
      </a>
    </li>
  </ul>
</div>

<div class="portal-card">
  <div class="section-eyebrow mb-1">Dashboards · Contracts</div>
  <h1 class="section-title mb-1">Contract inventory</h1>
  <p class="section-subtitle mb-3">
    All contracts with their vendor, currency and annual value for quick economic view.
  </p>

  {# KPIs + Export #}
  <div class="d-flex flex-wrap gap-3 mb-3 justify-content-between align-items-center">
    <div class="d-flex flex-wrap gap-3">
      <div class="portal-kpi">
        <div class="kpi-label text-muted small">Contracts in scope</div>
        <div class="kpi-value h4 mb-0">{{ contract_count }}</div>
      </div>
      <div class="portal-kpi">
        <div class="kpi-label text-muted small">Total annual value (all contracts)</div>
        <div class="kpi-value h4 mb-0">
          {% if total_annual %}
            {{ total_annual|floatformat:2 }}
          {% else %}
            —
          {% endif %}
        </div>
      </div>
    </div>

    <a href="?export=csv"
       class="btn btn-sm btn-outline-light">
      Export CSV
    </a>
  </div>

  {# вътрешен скрол само за таблицата #}
  <div class="table-responsive" style="max-height: 540px; overflow-y: auto;">
    <table class="portal-table align-middle">
      <thead>
        <tr>
          <th style="width: 30%;">Contract</th>
          <th style="width: 26%;">Vendor</th>
          <th style="width: 14%;">Currency</th>
          <th style="width: 30%;">Annual value</th>
        </tr>
      </thead>
      <tbody>
        {% if contract_count %}
          {% for contract in contracts %}
            <tr>
              <td>
                {{ contract.contract_name }}
                {% if contract.entity %}
                  <div class="cell-muted small">{{ contract.entity }}</div>
                {% endif %}
              </td>
              <td>
                {% if contract.vendor %}
                  {{ contract.vendor.name }}
                {% else %}
                  <span class="cell-muted">—</span>
                {% endif %}
              </td>
              <td>
                {% if contract.currency %}
                  {{ contract.currency }}
                {% else %}
                  <span class="cell-muted">—</span>
                {% endif %}
              </td>
              <td>
                {% if contract.annual_value %}
                  {{ contract.annual_value|floatformat:2 }}
                {% else %}
                  <span class="cell-muted">—</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td class="cell-muted" colspan="4">No contracts in scope yet.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <div class="row mt-4 g-3">
    <div class="col-lg-6">
      <h2 class="h6 text-white mb-2">What this view is for</h2>
      <ul class="section-subtitle mb-0">
        <li>Bring all market data and index contracts into a single economic view.</li>
        <li>Understand contract value by vendor, entity and currency at a glance.</li>
        <li>Support budgeting and renewal planning with a clean contract register.</li>
      </ul>
    </div>
    <div class="col-lg-6">
      <h2 class="h6 text-white mb-2">How clients typically use this</h2>
      <ul class="section-subtitle mb-0">
        <li>Prepare renewal packs for sourcing and negotiation cycles.</li>
        <li>Cross-check contract values against invoices and actual usage.</li>
        <li>Export the register to share with Procurement, Legal or Finance stakeholders.</li>
      </ul>
    </div>
  </div>
</div>
{% endblock %}
